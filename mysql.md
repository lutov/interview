← [Оглавление](https://github.com/lutov/interview/blob/main/README.md)

# MySQL

    * Индексы
        * Когда создавать индексы?
    * Хранимые процедуры
    * Триггеры в MySQL
    * Транзакции в MySQL
    * Команда HAVING
    * Профилирование запросов
    * Репликация
    * Партиционирование, шардинг
    

## Индексы

Индекс — это отсортированный набор значений. В MySQL индексы всегда строятся для какой-то конкретной колонки. В самом простом случае, индекс необходимо создавать для тех колонок, которые присутствуют в условии WHERE.

MySQL поддерживает уникальные индексы. Это удобно для колонок, значения в которых должны быть уникальными по всей таблице.

MySQL может использовать только один индекс для запроса. Поэтому, для запросов, в которых используется несколько колонок, необходимо использовать составные индексы.

Важно помнить, что индексы предполагают дополнительные операции записи на диск. При каждом обновлении или добавлении данных в таблицу, происходит также запись и обновление данных в индексе.

### Когда создавать индексы?

Индексы следует создавать по мере обнаружения медленных запросов. В этом поможет slow log в MySQL. Запросы, которые выполняются более 1 секунды являются первыми кандидатами на оптимизацию.

Начинайте создание индексов с самых частых запросов. Запрос, выполняющийся секунду, но 1000 раз в день наносит больше ущерба, чем 10-секундный запрос, который выполняется несколько раз в день.

Не создавайте индексы на таблицах, число записей в которых меньше нескольких тысяч. Для таких размеров выигрыш от использования индекса будет почти незаметен.

Не создавайте индексы заранее, например, в среде разработки. Индексы должны устанавливаться исключительно под форму и тип нагрузки работающей системы.

Удаляйте неиспользуемые индексы.

## Хранимые процедуры

Хранимая процедура MySQL представляет собой подпрограмму, хранящуюся в базе данных. Она содержит имя, список параметров и операторы SQL. Все популярные системы управления базами данных поддерживают хранимые процедуры. Они были введены в MySQL 5.

Существует два вида подпрограмм: хранимые процедуры и функции, возвращающие значения, которые используются в других операторах SQL (например, pi()).

Основное отличие заключается в том, что функции могут использоваться как любое другое выражение в операторах SQL, а хранимые процедуры должны вызываться с помощью оператора CALL.

## Триггеры в MySQL

Триггер — это хранимая процедура, которая не вызывается непосредственно, а исполняется при наступлении определенного события (вставка, удаление, обновление строки).
Поддержка триггеров в MySQL началась с версии 5.0.2

## Транзакции в MySQL

Транзакция — это операция, состоящая из одного или нескольких запросов к базе данных. Суть транзакций — обеспечить корректное выполнение всех запросов в рамках одной транзакции, а так-же обеспечить механизм изоляции транзакций друг от друга для решения проблемы совместного доступа к данным.

Любая транзакция либо выполняется полностью, либо не выполняется вообще.

В транзакционной модели есть два фундаментальных понятия: COMMIT и ROLLBACK. COMMIT означает фиксацию всех изменений в транзакции. ROLLBACK означает отмену (откат) изменений, произошедших в транзакции.

При старте транзакции все последующие изменения сохраняются во временном хранилище. В случае выполнения COMMIT, все изменения, выполненные в рамках одной транзакции, сохранятся в физическую БД. В случае выполнения ROLLBACK произойдет откат и все изменения, выполненные в рамках этой транзакции, не сохранятся.

В MySQL транзакции поддерживаются только таблицами innoDB. Таблицы MyISAM транзакции не поддерживают. В innoDB по умолчанию включен autocommit, это значит, что по умолчанию каждый запрос эквивалентен одной транзакции.

Транзакция начинается со специального запроса «START TRANSACTION», либо «BEGIN». Чтобы закончить транзакцию, нужно либо зафиксировать изменения (запрос COMMIT), либо откатить их (запрос ROLLBACK).

## Команда HAVING

Команда HAVING позволяет фильтровать результат группировки, сделанной с помощью команды GROUP BY.

В отличие от WHERE HAVING позволяет обращаться к алиасам в запросе.

## Профилирование запросов

```mysql
set profiling=1;
select count(*) from comment;
select count(*) from message;
show profiles;
```

## Репликация

Репликация - это техника масштабирования базы данных, при которой используется несколько одинаковых копий БД. Запись выполняется только в одну базу, а чтение может выполняться из разных копий в зависимости от различных условий, что может помочь распределить нагрузку на систему.

## Партиционирование, шардинг

Техники масштабирования базы данных. Суть в распределении данных по разным серверам. Могут быть разделены как отдельные таблицы, так и части одной большой таблицы по определенному признаку.
